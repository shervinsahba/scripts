#!/bin/bash
# a script to manage startup programs

logfile=~/.startup-log
exec 2>> $logfile

case "$1" in
	on-boot)
		date > $logfile
		redshift -l 47:-122 &
		autotiling &
		startup if-battery
		startup lock
		startup noisefilter
		startup taskbar-utilities
		yadm pull &
		git -C ~/src/scripts/ pull &
	;;

	on-restart)
		startup bar
		startup theme
		startup compositor
		autorandr --change
	;;

	bar|polybar)
		~/.config/polybar/polybar-launch mine
	;;

	compositor|picom)
		pkill picom && sleep 1
		picom --config ~/.config/picom/picom.conf &
	;;

	if-battery)
		if [ -e /sys/class/power_supply/BAT0 ]; then
			batsignal &
		fi
	;;	

	keyboard-layout)
		xmodmap "~/.Xmodmap"
	;;

	lock)
		screen-locker &
	;;

	noisefilter)
		easyeffects -l NoiseFilterVoice --gapplication-service &
	;;

	taskbar-utilities)
		udiskie --no-automount --notify --smart-tray &
		indicator-sound-switcher &
		syncthingtray --wait &
		nm-applet &
		blueman-applet &
	;;

	theme)
		wallpaper=~/.local/share/wallpapers/wood-background-1.jpg 
		feh --bg-fill $wallpaper || xsetroot -solid '#111111'
		wal --theme .config/wal/colorschemes/dark/batpuccin16.json &
	;;

	test)
		echo Test complete.
	;;

	help|*) 
		cat <<- EOF
		Usage: startup <option>
		  on-boot       	for startup programs on boot
		  on-restart 	   	for programs that need refresh on WM restart
		  bar				polybar
		  compositor		picom
		  if-battery		for battery based devices
		  keyboard-layout	xmodmap
		  lock				screensaver lock
		  noisefilter		noisefiltering for microphone
		  taskbar-utilities various programs that use the taskbar
		  theme				colors & theming
		EOF
esac
